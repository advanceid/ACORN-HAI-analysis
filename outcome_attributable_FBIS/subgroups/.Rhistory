group_names <- c("CRA", "3GCRE", "CRE")
letter_labels <- paste0("(", letters[1:length(group_names)], ") ", group_names)
# Define a common theme for all plots
theme_common <- theme(
text = element_text(family = "Poppins", size = 12),
axis.text = element_text(size = 12),
axis.title.x = element_text(size = 12, margin = margin(t = 7)),
axis.title.y = element_text(size = 12, margin = margin(r = 7)),
strip.background = element_rect(color = "black", fill = "white", linewidth = NA)
)
# Create an empty list to store the combined plots for each group
plot_list <- list()
# Loop through each dataset/result pair
for(i in seq_along(data_list)){
current_df  <- as.data.frame(data_list[[i]])
current_res <- res_list[[i]]
# Infection_Type factor
infection_levels <- levels(current_df$infection_types)
current_res$Infection_Type <- factor(current_res$Infection_Type, levels = infection_levels)
# Plot 1: FBIS score distribution u
p1 <- current_df %>%
ggplot(aes(x = RS, y = fbis_score, fill = RS)) +
ggdist::stat_halfeye(fill_type = "segments", alpha = 0.7,
scale = 1, adjust = 0.8,
interval_size = 0.5,
interval_color = "#440154FF",
point_interval = mean_qi, .width = c(0.5, 0.8, 0.95)) +
stat_summary(geom = "point", fun = mean, color = "#440154FF",
size = 2.5) +
facet_wrap(infection_types ~ ., ncol = 1, strip.position = "top") +
coord_flip() +
theme_minimal() +
labs(title = "", x = "", y = "FBIS score (mean with 95%CI)") +
scale_fill_manual(values = c("R" = "#27AD81FF", "S" = "#FDE725FF")) +
theme_common +
theme(legend.position = "none",
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p1 <- p1 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
p1 <- p1 + ggtitle(letter_labels[i]) +
theme(
plot.title = element_text(hjust = 0, face = "bold", size = 12),
plot.title.position = "plot",
plot.margin = margin(-10, 0, -10, -20)
)
# Plot 2: Attributable Fraction (AF) with 95% CI
p2 <- ggplot(current_res, aes(y = 1.5, x = Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_AF, xmax = Upper_AF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "AF (mean with 95%CI)") +
scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "black", face = "bold"))
if (i %in% c(1, 2)) {
p2 <- p2 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Plot 3: Population Attributable Fraction (PAF) with 95% CI
p3 <- ggplot(current_res, aes(y = 1.5, x = Population_Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_PAF, xmax = Upper_PAF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "PAF (mean with 95%CI)") +
scale_x_continuous(
labels = scales::percent_format(accuracy = 1),
limits = c(min(current_res$Lower_PAF, na.rm = TRUE) - 0.02,
max(current_res$Upper_PAF, na.rm = TRUE) + 0.02)
) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p3 <- p3 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Combine the three plots
combined_plot <- p1 + p2 + p3 +
patchwork::plot_layout(ncol = 3, widths = c(1, 1, 1))
# Save the combined plot to the list
plot_list[[i]] <- combined_plot
}
# Combine all group plots vertically and display
final_plot <- patchwork::wrap_plots(
plot_list[[1]],
plot_spacer(),
plot_list[[2]],
plot_spacer(),
plot_list[[3]],
ncol = 1,
heights = c(1, 0.1, 1, 0.1, 1)
)
print(final_plot)
# Save
CairoPDF("output/IQR_AF.pdf", width = 12, height = 12)
print(final_plot)
dev.off()
# Clear
rm(list = ls())
# Load packages
suppressPackageStartupMessages({
require(pacman)
pacman::p_load(dplyr,
magrittr,
ggdist,
ggplot2,
scales,
patchwork,
extrafont,
purrr,
Cairo)
})
# Define working directory
wd <- "./"
setwd(wd)
# Load fonts
loadfonts()
# Load data
df <- readRDS("1_car_aci/data/att_fbis.RData")
# PAF
res1 <- readRDS("1_car_aci/data/attfbis_table_paf_01.RData")
res2 <- readRDS("2_thir_ent/data/attfbis_table_paf_02.RData")
res3 <- readRDS("3_car_ent/data/attfbis_table_paf_03.RData")
###
# Acinetobacter, carbapenem-resistant
# Enterobacterales, third-generation cephalosporin-resistant
# Enterobacterales, carbapenem-resistant
###
df_selected <- df[1:3]
col_names <- c("aci_car", "ent_thir", "ent_car")
data_list <- map2(df_selected, col_names, ~ as.data.frame(.x) %>%
mutate(RS = ifelse(grepl("-resistant$", .x[[.y]]), "R", "S")))
res_list  <- list(res1, res2, res3)
group_names <- c("CRA", "3GCRE", "CRE")
letter_labels <- paste0("(", letters[1:length(group_names)], ") ", group_names)
# Define a common theme for all plots
theme_common <- theme(
text = element_text(family = "Poppins", size = 12),
axis.text = element_text(size = 12),
axis.title.x = element_text(size = 12, margin = margin(t = 7)),
axis.title.y = element_text(size = 12, margin = margin(r = 7)),
strip.background = element_rect(color = "black", fill = "white", linewidth = NA)
)
# Create an empty list to store the combined plots for each group
plot_list <- list()
# Loop through each dataset/result pair
for(i in seq_along(data_list)){
current_df  <- as.data.frame(data_list[[i]])
current_res <- res_list[[i]]
# Infection_Type factor
infection_levels <- levels(current_df$infection_types)
current_res$Infection_Type <- factor(current_res$Infection_Type, levels = infection_levels)
# Plot 1: FBIS score distribution u
p1 <- current_df %>%
ggplot(aes(x = RS, y = fbis_score, fill = RS)) +
ggdist::stat_halfeye(fill_type = "segments", alpha = 0.7,
scale = 1, adjust = 0.8,
interval_size = 0.5,
interval_color = "#440154FF",
point_interval = mean_qi, .width = c(0.8)) +
stat_summary(geom = "point", fun = mean, color = "#440154FF",
size = 2.5) +
facet_wrap(infection_types ~ ., ncol = 1, strip.position = "top") +
coord_flip() +
theme_minimal() +
labs(title = "", x = "", y = "FBIS score (mean with 95%CI)") +
scale_fill_manual(values = c("R" = "#27AD81FF", "S" = "#FDE725FF")) +
theme_common +
theme(legend.position = "none",
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p1 <- p1 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
p1 <- p1 + ggtitle(letter_labels[i]) +
theme(
plot.title = element_text(hjust = 0, face = "bold", size = 12),
plot.title.position = "plot",
plot.margin = margin(-10, 0, -10, -20)
)
# Plot 2: Attributable Fraction (AF) with 95% CI
p2 <- ggplot(current_res, aes(y = 1.5, x = Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_AF, xmax = Upper_AF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "AF (mean with 95%CI)") +
scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "black", face = "bold"))
if (i %in% c(1, 2)) {
p2 <- p2 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Plot 3: Population Attributable Fraction (PAF) with 95% CI
p3 <- ggplot(current_res, aes(y = 1.5, x = Population_Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_PAF, xmax = Upper_PAF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "PAF (mean with 95%CI)") +
scale_x_continuous(
labels = scales::percent_format(accuracy = 1),
limits = c(min(current_res$Lower_PAF, na.rm = TRUE) - 0.02,
max(current_res$Upper_PAF, na.rm = TRUE) + 0.02)
) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p3 <- p3 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Combine the three plots
combined_plot <- p1 + p2 + p3 +
patchwork::plot_layout(ncol = 3, widths = c(1, 1, 1))
# Save the combined plot to the list
plot_list[[i]] <- combined_plot
}
# Combine all group plots vertically and display
final_plot <- patchwork::wrap_plots(
plot_list[[1]],
plot_spacer(),
plot_list[[2]],
plot_spacer(),
plot_list[[3]],
ncol = 1,
heights = c(1, 0.1, 1, 0.1, 1)
)
print(final_plot)
# Save
CairoPDF("output/IQR_AF.pdf", width = 12, height = 12)
print(final_plot)
dev.off()
# Clear
rm(list = ls())
# Load packages
suppressPackageStartupMessages({
require(pacman)
pacman::p_load(dplyr,
magrittr,
ggdist,
ggplot2,
scales,
patchwork,
extrafont,
purrr,
Cairo)
})
# Define working directory
wd <- "./"
setwd(wd)
# Load fonts
loadfonts()
# Load data
df <- readRDS("1_car_aci/data/att_fbis.RData")
# PAF
res1 <- readRDS("1_car_aci/data/attfbis_table_paf_01.RData")
res2 <- readRDS("2_thir_ent/data/attfbis_table_paf_02.RData")
res3 <- readRDS("3_car_ent/data/attfbis_table_paf_03.RData")
###
# Acinetobacter, carbapenem-resistant
# Enterobacterales, third-generation cephalosporin-resistant
# Enterobacterales, carbapenem-resistant
###
df_selected <- df[1:3]
col_names <- c("aci_car", "ent_thir", "ent_car")
data_list <- map2(df_selected, col_names, ~ as.data.frame(.x) %>%
mutate(RS = ifelse(grepl("-resistant$", .x[[.y]]), "R", "S")))
res_list  <- list(res1, res2, res3)
group_names <- c("CRA", "3GCRE", "CRE")
letter_labels <- paste0("(", letters[1:length(group_names)], ") ", group_names)
# Define a common theme for all plots
theme_common <- theme(
text = element_text(family = "Poppins", size = 12),
axis.text = element_text(size = 12),
axis.title.x = element_text(size = 12, margin = margin(t = 7)),
axis.title.y = element_text(size = 12, margin = margin(r = 7)),
strip.background = element_rect(color = "black", fill = "white", linewidth = NA)
)
# Create an empty list to store the combined plots for each group
plot_list <- list()
# Loop through each dataset/result pair
for(i in seq_along(data_list)){
current_df  <- as.data.frame(data_list[[i]])
current_res <- res_list[[i]]
# Infection_Type factor
infection_levels <- levels(current_df$infection_types)
current_res$Infection_Type <- factor(current_res$Infection_Type, levels = infection_levels)
# Plot 1: FBIS score distribution u
p1 <- current_df %>%
ggplot(aes(x = RS, y = fbis_score, fill = RS)) +
ggdist::stat_halfeye(fill_type = "segments", alpha = 0.7,
scale = 1, adjust = 0.8,
interval_size = 0.5,
interval_color = "#440154FF",
point_interval = mean_qi, .width = c(0.5)) +
stat_summary(geom = "point", fun = mean, color = "#440154FF",
size = 2.5) +
facet_wrap(infection_types ~ ., ncol = 1, strip.position = "top") +
coord_flip() +
theme_minimal() +
labs(title = "", x = "", y = "FBIS score (mean with IQR)") +
scale_fill_manual(values = c("R" = "#27AD81FF", "S" = "#FDE725FF")) +
theme_common +
theme(legend.position = "none",
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p1 <- p1 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
p1 <- p1 + ggtitle(letter_labels[i]) +
theme(
plot.title = element_text(hjust = 0, face = "bold", size = 12),
plot.title.position = "plot",
plot.margin = margin(-10, 0, -10, -20)
)
# Plot 2: Attributable Fraction (AF) with 95% CI
p2 <- ggplot(current_res, aes(y = 1.5, x = Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_AF, xmax = Upper_AF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "AF (mean with 95%CI)") +
scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "black", face = "bold"))
if (i %in% c(1, 2)) {
p2 <- p2 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Plot 3: Population Attributable Fraction (PAF) with 95% CI
p3 <- ggplot(current_res, aes(y = 1.5, x = Population_Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_PAF, xmax = Upper_PAF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "PAF (mean with 95%CI)") +
scale_x_continuous(
labels = scales::percent_format(accuracy = 1),
limits = c(min(current_res$Lower_PAF, na.rm = TRUE) - 0.02,
max(current_res$Upper_PAF, na.rm = TRUE) + 0.02)
) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p3 <- p3 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Combine the three plots
combined_plot <- p1 + p2 + p3 +
patchwork::plot_layout(ncol = 3, widths = c(1, 1, 1))
# Save the combined plot to the list
plot_list[[i]] <- combined_plot
}
# Combine all group plots vertically and display
final_plot <- patchwork::wrap_plots(
plot_list[[1]],
plot_spacer(),
plot_list[[2]],
plot_spacer(),
plot_list[[3]],
ncol = 1,
heights = c(1, 0.1, 1, 0.1, 1)
)
print(final_plot)
# Save
CairoPDF("output/IQR_AF.pdf", width = 12, height = 12)
print(final_plot)
dev.off()
# Clear
rm(list = ls())
# Load packages
suppressPackageStartupMessages({
require(pacman)
pacman::p_load(dplyr,
magrittr,
ggdist,
ggplot2,
scales,
patchwork,
extrafont,
purrr,
Cairo)
})
# Define working directory
wd <- "./"
setwd(wd)
# Load fonts
loadfonts()
# Load data
df <- readRDS("1_car_aci/data/att_fbis.RData")
# PAF
res1 <- readRDS("1_car_aci/data/attfbis_table_paf_01.RData")
res2 <- readRDS("2_thir_ent/data/attfbis_table_paf_02.RData")
res3 <- readRDS("3_car_ent/data/attfbis_table_paf_03.RData")
###
# Acinetobacter, carbapenem-resistant
# Enterobacterales, third-generation cephalosporin-resistant
# Enterobacterales, carbapenem-resistant
###
df_selected <- df[1:3]
col_names <- c("aci_car", "ent_thir", "ent_car")
data_list <- map2(df_selected, col_names, ~ as.data.frame(.x) %>%
mutate(RS = ifelse(grepl("-resistant$", .x[[.y]]), "R", "S")))
res_list  <- list(res1, res2, res3)
group_names <- c("CRA", "3GCRE", "CRE")
letter_labels <- paste0("(", letters[1:length(group_names)], ") ", group_names)
# Define a common theme for all plots
theme_common <- theme(
text = element_text(family = "Poppins", size = 12),
axis.text = element_text(size = 12),
axis.title.x = element_text(size = 12, margin = margin(t = 7)),
axis.title.y = element_text(size = 12, margin = margin(r = 7)),
strip.background = element_rect(color = "black", fill = "white", linewidth = NA)
)
# Create an empty list to store the combined plots for each group
plot_list <- list()
# Loop through each dataset/result pair
for(i in seq_along(data_list)){
current_df  <- as.data.frame(data_list[[i]])
current_res <- res_list[[i]]
# Infection_Type factor
infection_levels <- levels(current_df$infection_types)
current_res$Infection_Type <- factor(current_res$Infection_Type, levels = infection_levels)
# Plot 1: FBIS score distribution u
p1 <- current_df %>%
ggplot(aes(x = RS, y = fbis_score, fill = RS)) +
ggdist::stat_halfeye(fill_type = "segments", alpha = 0.7,
scale = 1, adjust = 0.8,
interval_size = 0.2,
interval_color = "#440154FF",
point_interval = mean_qi, .width = c(0.5)) +
stat_summary(geom = "point", fun = mean, color = "#440154FF",
size = 2.5) +
facet_wrap(infection_types ~ ., ncol = 1, strip.position = "top") +
coord_flip() +
theme_minimal() +
labs(title = "", x = "", y = "FBIS score (mean with IQR)") +
scale_fill_manual(values = c("R" = "#27AD81FF", "S" = "#FDE725FF")) +
theme_common +
theme(legend.position = "none",
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p1 <- p1 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
p1 <- p1 + ggtitle(letter_labels[i]) +
theme(
plot.title = element_text(hjust = 0, face = "bold", size = 12),
plot.title.position = "plot",
plot.margin = margin(-10, 0, -10, -20)
)
# Plot 2: Attributable Fraction (AF) with 95% CI
p2 <- ggplot(current_res, aes(y = 1.5, x = Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_AF, xmax = Upper_AF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "AF (mean with 95%CI)") +
scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "black", face = "bold"))
if (i %in% c(1, 2)) {
p2 <- p2 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Plot 3: Population Attributable Fraction (PAF) with 95% CI
p3 <- ggplot(current_res, aes(y = 1.5, x = Population_Attributable_Fraction)) +
facet_wrap(~ Infection_Type, ncol = 1, strip.position = "top") +
geom_point(color = "black", size = 2.5, shape = 15) +
geom_errorbarh(aes(xmin = Lower_PAF, xmax = Upper_PAF), height = 0, color = "black") +
geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
theme_minimal() +
labs(y = NULL, x = "PAF (mean with 95%CI)") +
scale_x_continuous(
labels = scales::percent_format(accuracy = 1),
limits = c(min(current_res$Lower_PAF, na.rm = TRUE) - 0.02,
max(current_res$Upper_PAF, na.rm = TRUE) + 0.02)
) +
theme_common +
theme(axis.text.y = element_blank(),
strip.text = element_text(size = 12, color = "white", face = "bold"))
if (i %in% c(1, 2)) {
p3 <- p3 + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
}
# Combine the three plots
combined_plot <- p1 + p2 + p3 +
patchwork::plot_layout(ncol = 3, widths = c(1, 1, 1))
# Save the combined plot to the list
plot_list[[i]] <- combined_plot
}
# Combine all group plots vertically and display
final_plot <- patchwork::wrap_plots(
plot_list[[1]],
plot_spacer(),
plot_list[[2]],
plot_spacer(),
plot_list[[3]],
ncol = 1,
heights = c(1, 0.1, 1, 0.1, 1)
)
print(final_plot)
# Save
CairoPDF("output/IQR_AF.pdf", width = 12, height = 12)
print(final_plot)
dev.off()
